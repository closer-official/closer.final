<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLOSER | The Standard of Sales</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+JP:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <style>
        /* タブ切り替え用のスタイル */
        .auth-tabs { display: flex; justify-content: center; margin-bottom: 30px; border-bottom: 1px solid #333; }
        .auth-tab {
            padding: 10px 30px; cursor: pointer; color: #666; font-family: 'Cinzel', serif; letter-spacing: 0.1em;
            border-bottom: 2px solid transparent; transition: all 0.3s;
        }
        .auth-tab.active { color: var(--gold-color); border-bottom: 2px solid var(--gold-color); }
        .auth-form { display: none; }
        .auth-form.active { display: block; animation: fadeIn 0.5s; }
    </style>
</head>
<body>

    <div id="opening">
        <div id="opening-logo" class="gold-text">CLOSER</div>
    </div>

    <header>
    <div class="logo gold-text">CLOSER</div>
    <a href="javascript:void(0)" class="alpha-btn" onclick="alert('Blackメンバーシップは招待制です')">BLACK</a>
    </header>

    <div id="public-view">
        <div class="hero">
            <h1 class="fade-in">PROOF<br>OF<br><span class="gold-text">TALK</span></h1>
            <p class="fade-in">営業の実力は、口で証明せよ。</p>
        </div>

        <div class="join-section">
            <div class="container fade-in">
                
                <div class="auth-tabs">
                    <div id="tab-register" class="auth-tab active" onclick="switchTab('register')">REGISTER</div>
                    <div id="tab-login" class="auth-tab" onclick="switchTab('login')">LOGIN</div>
                </div>

                <div id="form-register" class="auth-form active">
                    <h2 class="gold-text" style="margin-bottom: 20px;">JOIN THE WAITING LIST</h2>
                    <p style="margin-bottom: 30px; color: #888;">完全招待制のため、ウェイティングリストへ登録します。</p>
                    <form id="register-form">
                        <div class="input-group">
                            <label>NAME</label>
                            <input type="text" id="reg-name" class="input-field" placeholder="山田 太郎" required>
                        </div>
                        <div class="input-group">
                            <label>EMAIL</label>
                            <input type="email" id="reg-email" class="input-field" placeholder="example@closer.jp" required>
                        </div>
                        <div class="input-group">
                            <label>PASSWORD</label>
                            <input type="password" id="reg-pass" class="input-field" placeholder="パスワード（6文字以上）" required minlength="6">
                        </div>
                        <button type="submit" class="btn btn-full btn-fill">アカウント作成</button>
                    </form>
                </div>

                <div id="form-login" class="auth-form">
                    <h2 class="gold-text" style="margin-bottom: 20px;">MEMBER LOGIN</h2>
                    <p style="margin-bottom: 30px; color: #888;">アカウントをお持ちの方はこちら。</p>
                    <form id="login-form">
                        <div class="input-group">
                            <label>EMAIL</label>
                            <input type="email" id="login-email" class="input-field" placeholder="example@closer.jp" required>
                        </div>
                        <div class="input-group">
                            <label>PASSWORD</label>
                            <input type="password" id="login-pass" class="input-field" placeholder="パスワード" required>
                        </div>
                        <button type="submit" class="btn btn-full btn-fill">ログイン</button>
                    </form>
                </div>

            </div>
        </div>

        <footer style="padding: 30px; text-align: center; color: #333; font-size: 0.8rem;">
            &copy; 2025 CLOSER Project.
        </footer>
    </div>

    <script src="js/main.js"></script>

    <script type="module">
        import { auth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile, db, doc, setDoc, serverTimestamp } 
        from "./js/firebase-config.js";

        // タブ切り替え関数
        window.switchTab = (tab) => {
            document.querySelectorAll('.auth-tab').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(el => el.classList.remove('active'));
            
            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('form-' + tab).classList.add('active');
        }

        // --- 新規登録処理 ---
        const registerForm = document.getElementById('register-form');
        if(registerForm) {
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = registerForm.querySelector('button');
                const name = document.getElementById('reg-name').value;
                const email = document.getElementById('reg-email').value;
                const pass = document.getElementById('reg-pass').value;

                try {
                    btn.innerText = "通信中..."; btn.disabled = true;
                    // Firebase Auth作成
                    const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                    const user = userCredential.user;
                    // プロフィール更新
                    await updateProfile(user, { displayName: name });
                    // Firestore保存
                    await setDoc(doc(db, "users", user.uid), {
                        uid: user.uid, name: name, email: email,
                        rank: "Standard", role: "Observer", score_act: 0,
                        created_at: serverTimestamp()
                    });
                    
                    alert("WELCOME, " + name.toUpperCase());
                    // ★ここを timeline.html に変更
                    window.location.href = "timeline.html";

                } catch (error) {
                    console.error(error); alert("エラー: " + error.message);
                    btn.innerText = "アカウント作成"; btn.disabled = false;
                }
            });
        }

        // --- ログイン処理 ---
        const loginForm = document.getElementById('login-form');
        if(loginForm) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = loginForm.querySelector('button');
                const email = document.getElementById('login-email').value;
                const pass = document.getElementById('login-pass').value;

                try {
                    btn.innerText = "認証中..."; btn.disabled = true;
                    // Firebase Login
                    await signInWithEmailAndPassword(auth, email, pass);
                    
                    // ★ここを timeline.html に変更
                    window.location.href = "timeline.html";

                } catch (error) {
                    console.error(error); alert("ログイン失敗: メールアドレスかパスワードが間違っています。");
                    btn.innerText = "ログイン"; btn.disabled = false;
                }
            });
        }
    </script>
</body>
</html>